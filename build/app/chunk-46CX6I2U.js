import{c as F,e as j,g as A,h as T,l as B,o as L,r as U,v as G,w as V,y as H}from"./chunk-ALENL7MX.js";import{a as N}from"./chunk-FVU4BDPN.js";import{b as D}from"./chunk-I66BKAGK.js";import"./chunk-ZSSD5RUB.js";import{a as c}from"./chunk-2LP224VR.js";import{c as O,d as k,g as I}from"./chunk-DSTAATMF.js";import"./chunk-DQSHFWXE.js";import{$ as C,$b as i,Bb as m,Ib as n,Jb as o,Kb as l,Mc as S,Nb as M,Qb as w,Rb as v,Sc as E,Za as h,_c as R,ab as p,ea as y,gb as g,la as x,ma as _,nb as P,u as f,ub as b}from"./chunk-EYQN4OQ3.js";var u=class s{constructor(r){this.http=r}apiUrl=c.apiUrl;getMileageDetails(){return this.http.get(this.apiUrl+"/mileageDetails")}filterMileageDetails(r,e,t){return this.getMileageDetails().pipe(f(a=>a.filter(d=>d.model_type===r&&d.fuel_type===e&&d.vehicle_type===t)))}getUniqueEngineCapacities(r,e,t){return this.filterMileageDetails(r,e,t).pipe(f(a=>[...new Set(a.map(d=>d.car_capacity))]))}sendEmail(r,e,t){let a={host:c.host,username:c.username,password:c.password,secure:c.secure,port:c.port,to:r,subject:e,body:t};return this.http.post(this.apiUrl+"/sendEmail",a)}static \u0275fac=function(e){return new(e||s)(y(R))};static \u0275prov=C({token:s,factory:s.\u0275fac,providedIn:"root"})};function J(s,r){s&1&&(n(0,"div",28),i(1," Your Email is required "),o())}function Q(s,r){if(s&1){let e=M();n(0,"div",29)(1,"div",30)(2,"span",31),i(3,"A code has been sent to your email."),o(),l(4,"br"),i(5," Did't get the code "),n(6,"button",32),i(7,"Resend"),o()(),n(8,"div",33),i(9," Code: "),l(10,"input",34),i(11," New Password: "),l(12,"input",35),i(13," Confirm New Password: "),l(14,"input",36)(15,"hr"),n(16,"a",37),w("click",function(){x(e);let a=v();return _(a.saveNewPassword())}),i(17,"Save New Password"),o()()()}}function W(s,r){if(s&1&&(n(0,"button",38),l(1,"i",39),i(2," Reset Password "),o()),s&2){let e=v();m("disabled",e.passwordForm.invalid)}}function X(s,r){s&1&&(n(0,"span"),l(1,"div",40)(2,"div",41)(3,"div",42),o())}var z=class s{constructor(r,e,t,a,d){this.fb=r;this.authService=e;this.router=t;this.toast=a;this.genService=d}passwordForm;errorMessage="";isLoading=!1;sharedCode=0;userEmail="";showPasswordReset=!1;showResetButton=!0;ngOnInit(){this.passwordForm=this.fb.group({names:["",[j.required]]})}onSubmit(){var r=this.passwordForm.value.names;this.isLoading=!0,this.showResetButton=!1,this.authService.getUserByEmail(r).subscribe(e=>{if(console.log(e),e=="Not Found")this.toast.showError("Invalid Email","The email entered is not registered."),this.isLoading=!1,this.showResetButton=!0;else{let t=Math.floor(Math.random()*9999)+1e4;this.sharedCode=t,this.userEmail=r;let a="Dear "+e.names+", Your code to reset password for AAKenya Best Driver Contest is:  "+t;this.genService.sendEmail(r,"Reset Password AAKenya Best Driver Contest",a).subscribe(d=>{this.toast.showSuccess("RESET CODE","A code to reset pasword has been sent to your email"),this.isLoading=!1,this.showPasswordReset=!0,this.showResetButton=!1})}})}saveNewPassword(){var r=document.getElementById("sent_code"),e=Number(r.value),t=document.getElementById("password1"),a=t.value,d=document.getElementById("password2"),Y=d.value;e==0||e==null||a==""?this.toast.showError("Invalid Code","Please enter valid code sent to your email and ensure you enter your new prefered password"):e==this.sharedCode?Y==a?this.authService.resetPassword(this.userEmail,a).subscribe(Z=>{this.toast.showSuccess("Success","Your password has been reset successifully. Please login now"),this.router.navigate(["/login"])}):this.toast.showError("Password Mismatch","The confimation password is not the same as the New password Entered"):this.toast.showError("Invalid Code","Please enter valid code")}get names(){return this.passwordForm.get("names")}static \u0275fac=function(e){return new(e||s)(g(V),g(N),g(O),g(D),g(u))};static \u0275cmp=P({type:s,selectors:[["app-password-reset"]],decls:41,vars:5,consts:[["lang","en"],["charset","UTF-8"],["name","viewport","content","width=device-width, initial-scale=1.0"],["href",h`https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css`,"rel","stylesheet"],["href",h`https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css`,"rel","stylesheet"],[1,"container"],[1,"login-card"],[1,"login-header"],[1,"login-icon"],["routerLink","/bestdrivercontest"],["src","assets/dist/images/logo/byd1.png",2,"height","150px"],[2,"color","#006544"],[3,"ngSubmit","formGroup"],[1,"input-group","mb-3"],["type","email","formControlName","names","id","names","required","","placeholder","Enter Your Email",1,"form-control"],[1,"input-group-append"],[1,"input-group-text"],[1,"fas","fa-envelope"],["class","error",4,"ngIf"],["class","card",4,"ngIf"],["type","submit","class","btn btn-login btn-success",3,"disabled",4,"ngIf"],[1,"loading-part"],[4,"ngIf"],[1,"register-link"],["routerLink","/login",1,"text-center"],["routerLink","/register",1,"text-center"],[2,"width","100%","text-align","center"],["href","https://www.aakenya.co.ke","target","_blank",2,"color","#006544"],[1,"error"],[1,"card"],[1,"card-header","text-center"],[2,"color","goldenrod"],["type","submit",1,"btn","btn-outline-warning","btn-sm"],[1,"card-body"],["type","text","placeholder","Enter Code Sent","id","sent_code",1,"form-control"],["type","password","placeholder","Enter New Password","id","password1",1,"form-control"],["type","password","placeholder","Re-Enter New Password","id","password2",1,"form-control"],[1,"btn","btn-outline-success","btn-sm",3,"click"],["type","submit",1,"btn","btn-login","btn-success",3,"disabled"],[1,"fas","fa-sign-in-alt","me-2"],[1,"spinner-grow","text-success"],[1,"spinner-grow","text-secondary"],[1,"spinner-grow","text-warning"]],template:function(e,t){e&1&&(n(0,"html",0)(1,"head"),l(2,"meta",1)(3,"meta",2),n(4,"title"),i(5,"AA Kenya:: Reset Password"),o(),l(6,"link",3)(7,"link",4),o(),n(8,"body")(9,"div",5)(10,"div",6)(11,"div",7)(12,"div",8)(13,"a",9),l(14,"img",10),o()(),n(15,"h3",11),i(16,"Reset Password"),o()(),n(17,"form",12),w("ngSubmit",function(){return t.onSubmit()}),n(18,"div",13),l(19,"input",14),n(20,"div",15)(21,"div",16),l(22,"span",17),o()()(),b(23,J,2,0,"div",18)(24,Q,18,0,"div",19)(25,W,3,1,"button",20),n(26,"div",21),b(27,X,4,0,"span",22),o()(),n(28,"div",23),i(29," Back to "),n(30,"a",24),i(31," Login"),o(),i(32," OR "),n(33,"a",25),i(34," Register"),o()(),l(35,"br"),n(36,"h6",26),i(37,"Copyright \xA9 2025 "),n(38,"a",27),i(39,"AA Kenya"),o(),i(40,". All rights reserved."),o()()()()()),e&2&&(p(17),m("formGroup",t.passwordForm),p(6),m("ngIf",(t.names==null?null:t.names.invalid)&&(t.names==null?null:t.names.touched)),p(),m("ngIf",t.showPasswordReset),p(),m("ngIf",t.showResetButton==!0),p(2),m("ngIf",t.isLoading==!0))},dependencies:[E,S,H,B,F,A,T,G,L,U,I,k],styles:['body[_ngcontent-%COMP%]{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;background:url("./media/2R6A9822-HUKAVV4G.jpg") no-repeat center center fixed;background-size:cover}body[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:linear-gradient(120deg,#f5eb6c99,#0aaa4299);z-index:0}.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;position:relative;z-index:1}.login-card[_ngcontent-%COMP%]{background:#fffffff2;opacity:.8;border-radius:1rem;box-shadow:0 0 20px #00000026;overflow:hidden;max-width:400px;width:90%;padding:2rem;transition:transform .3s ease;margin:auto;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.login-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.login-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.login-icon[_ngcontent-%COMP%]{background:none;width:100px;height:150px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem}.login-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#fff}.form-floating[_ngcontent-%COMP%]{margin-bottom:1rem}.form-control[_ngcontent-%COMP%]:focus{border-color:#d2e42d;box-shadow:0 0 0 .25rem #b7b9b740}.btn-login[_ngcontent-%COMP%]{background:#046241;border:none;padding:.8rem;font-weight:500;width:100%;margin-top:1rem;transition:all .3s ease}.btn-login[_ngcontent-%COMP%]:hover{background:#fcd738;transform:translateY(-2px)}.social-login[_ngcontent-%COMP%]{margin-top:2rem;text-align:center}.social-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;margin:0 .5rem;color:#fff;transition:transform .3s ease}.social-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.facebook[_ngcontent-%COMP%]{background:#3b5998}.google[_ngcontent-%COMP%]{background:#db4437}.twitter[_ngcontent-%COMP%]{background:#1da1f2}.register-link[_ngcontent-%COMP%]{text-align:center;margin-top:1.5rem}.form-control[_ngcontent-%COMP%]{background:#ffffffe6}.form-control[_ngcontent-%COMP%]:focus{background:#fffffff2}.error[_ngcontent-%COMP%]{color:red;font-size:.8em;margin-top:5px}.error-message[_ngcontent-%COMP%]{color:red;text-align:center}.hold-transition[_ngcontent-%COMP%]{width:100%}.mileage-heading[_ngcontent-%COMP%]{color:#daa520;font-family:Courier New,Courier,monospace}.loading-part[_ngcontent-%COMP%]{text-align:center}h3[_ngcontent-%COMP%]{font-size:large}']})};export{z as PasswordResetComponent};
