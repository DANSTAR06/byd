import{c as B,g as D,h as U,i as K,k as R,l as L,m as W,v as j,x as Y}from"./chunk-ALENL7MX.js";import{a as H,b as z}from"./chunk-MBHGYJ4R.js";import{a as G}from"./chunk-RITIWUCH.js";import{a as q}from"./chunk-BQPUOODS.js";import{a as F}from"./chunk-FVU4BDPN.js";import{b as A}from"./chunk-I66BKAGK.js";import"./chunk-ZSSD5RUB.js";import"./chunk-2LP224VR.js";import{c as M}from"./chunk-DSTAATMF.js";import"./chunk-DQSHFWXE.js";import{$b as t,Bb as y,Ib as e,Jb as i,Kb as m,Mc as k,Nb as v,Qb as g,Rb as l,Rc as N,Sc as V,ab as s,ac as h,bc as P,cc as I,dc as T,ec as E,fc as w,gb as u,la as d,ma as p,mc as S,nb as C,nc as x,ub as _}from"./chunk-EYQN4OQ3.js";function O(o,c){if(o&1){let n=v();e(0,"button",24),g("click",function(){d(n);let r=l();return p(r.changeCategory())}),t(1,"Change Category"),i()}}function Q(o,c){if(o&1){let n=v();e(0,"div",25),t(1," You registration fee for this application has been received. Please proceed to assesment stage"),m(2,"br")(3,"br"),e(4,"button",26),g("click",function(){d(n);let r=l();return p(r.goToAssesment())}),t(5,"Take Assesment"),i()()}}function X(o,c){o&1&&(e(0,"div",39)(1,"div",40)(2,"span",41),t(3,"Loading..."),i()(),e(4,"div",42)(5,"span",41),t(6,"Loading..."),i()(),e(7,"div",43)(8,"span",41),t(9,"Loading..."),i()(),m(10,"br"),t(11," Initiating Mpesa STK... "),i())}function Z(o,c){if(o&1){let n=v();e(0,"div",44),t(1," Mpesa STK Intiated. "),m(2,"br"),t(3),m(4,"br"),e(5,"button",45),g("click",function(){d(n);let r=l(2);return p(r.payNow(r.categoryFees-r.applicantTotalPayment))}),m(6,"i",46),t(7," Retry"),i(),e(8,"button",36),g("click",function(){d(n);let r=l(2);return p(r.completePayment())}),m(9,"i",37)(10,"i",38),t(11," Completed"),i()()}if(o&2){let n=l(2);s(3),P("Please check phone ",n.phone," to complete the payment")}}function $(o,c){if(o&1){let n=v();e(0,"div",47)(1,"button",48),g("click",function(){d(n);let r=l(2);return p(r.payNow(r.categoryFees-r.applicantTotalPayment))}),m(2,"i",29),t(3," Pay"),i(),e(4,"button",49),m(5,"i",50),t(6,"Cancel"),i()()}}function ee(o,c){if(o&1){let n=v();e(0,"div",27)(1,"div",10)(2,"div",28)(3,"h4",20),m(4,"i",29),t(5," How to pay:-"),i()()(),e(6,"div",10)(7,"div",4)(8,"div",30)(9,"div",13)(10,"b"),t(11,"Method 1: Mpesa STK Prompt"),i()(),e(12,"div",16)(13,"form")(14,"label"),t(15,"Enter Mpesa Number"),i(),e(16,"input",31),w("ngModelChange",function(r){d(n);let b=l();return E(b.phone,r)||(b.phone=r),p(r)}),i()()(),e(17,"div",32),_(18,X,12,0,"div",33)(19,Z,12,1,"div",34)(20,$,7,0,"div",35),i()()(),e(21,"div",4)(22,"div",30)(23,"div",13)(24,"b"),t(25,"Method 2: Lipa Na Mpesa"),i()(),e(26,"div",16)(27,"ol")(28,"li"),t(29,"Go to Lipa Na Mpesa"),i(),e(30,"li"),t(31,"Enter Paybill Number: "),e(32,"b"),t(33,"927137"),i()(),e(34,"li"),t(35,"Enter Acount Number: "),e(36,"b"),t(37),i()(),e(38,"li"),t(39,"Enter Amount: "),e(40,"b"),t(41),i()(),e(42,"li"),t(43,"Enter PIN"),i()(),e(44,"button",36),g("click",function(){d(n);let r=l();return p(r.completePayment())}),m(45,"i",37)(46,"i",38),t(47," Completed?"),i()()()()()()}if(o&2){let n=l();s(16),T("ngModel",n.phone),s(2),y("ngIf",n.isIntiating==!0),s(),y("ngIf",n.isWaitingPayment==!0),s(),y("ngIf",n.isIntiating==!1&&n.isWaitingPayment==!1),s(17),I("",n.packageType,"",n.userId,""),s(4),h(n.categoryFees-n.applicantTotalPayment)}}var J=class o{constructor(c,n,a,r,b,te){this.paymentService=c;this.categoryService=n;this.router=a;this.authService=r;this.customerService=b;this.toast=te;this.currentUser=this.authService.extractUser(),this.phone=this.currentUser?.phone,this.userId=this.currentUser?.user_id,this.customerService.getUserById(this.userId).subscribe(f=>{this.phone=f.phone_number}),this.paymentService.getApplicantTotalPayments(this.userId).subscribe(f=>{this.applicantTotalPayment=f}),this.categoryService.getApplicantAppliedCategory(this.userId).subscribe(f=>{this.savedCategory=f,this.categoryId=this.savedCategory.data[0].category_id,this.categoryFees=this.savedCategory.data[0].category.cat_fees,this.categoryName=this.savedCategory.data[0].category.cat_name,this.categoryId==1&&(this.packageType="BYDA"),this.categoryId==2&&(this.packageType="BYDB"),this.categoryId==3&&(this.packageType="BYDC"),this.categoryId==4&&(this.packageType="BYDD"),this.categoryId==5&&(this.packageType="BYDE")})}savedCategory;categoryName;categoryId;categoryFees;packageType;applicantTotalPayment;currentUser;phone;userId;amountToPay;isIntiating=!1;isWaitingPayment=!1;apiURL=G.apiUrl;changeCategory(){this.categoryService.deleteUserCategories(this.userId).subscribe(c=>{this.router.navigate(["/driver/dashboard"])})}goToAssesment(){this.router.navigate(["/driver/questions"])}payNow(c){let n={amount:c,phone:this.phone.toString(),description:"Payement for Best Driver Competitions",accountName:this.packageType+this.userId.toString(),callBackUrl:this.apiURL+"/mpesaCallBack",status:"SENT"};this.isIntiating=!0,this.isWaitingPayment=!1,this.paymentService.intiateSTK(n).subscribe(a=>{this.isIntiating=!1,this.isWaitingPayment=!0,a?.status=="PENDING"?this.toast.showSuccess("STK Intiated","Please check phone "+n.phone+" and complete the payment"):this.toast.showError("STK not Intiated","Please check your phone number. Use your actual phone number")})}completePayment(){}static \u0275fac=function(n){return new(n||o)(u(z),u(H),u(M),u(F),u(q),u(A))};static \u0275cmp=C({type:o,selectors:[["app-payment"]],decls:56,vars:13,consts:[[1,"content-wrapper"],[1,"content-header"],[1,"container-fluid"],[1,"row","mb-2"],[1,"col-sm-6"],[1,"breadcrumb","float-sm-right"],[1,"breadcrumb-item"],["routerLink","/customer"],[1,"breadcrumb-item","active"],[1,"content"],[1,"row"],[1,"col-md-12"],[1,"card","card-warning","card-outline"],[1,"card-header"],[1,"card-title"],[1,"fa","fa-edit"],[1,"card-body"],[1,"table","table-borderless"],["scope","row"],["class","btn btn-outline-warning btn-xs",3,"click",4,"ngIf"],[2,"color","green"],[2,"color","red"],["class","payment-div","style","text-align: center;",4,"ngIf"],["class","payment-div",4,"ngIf"],[1,"btn","btn-outline-warning","btn-xs",3,"click"],[1,"payment-div",2,"text-align","center"],[1,"btn","btn-outline-success",3,"click"],[1,"payment-div"],[1,"col-sm-12"],["aria-hidden","true",1,"fa","fa-credit-card"],[1,"card"],["type","number","id","phone","name","phone","required","",1,"form-control",2,"color","goldenrod",3,"ngModelChange","ngModel"],[1,"card-footer"],["class","progressing",4,"ngIf"],["class","payment-waitin",4,"ngIf"],["class","footer-button",4,"ngIf"],["type","button","mat-dialog-close","",1,"btn","btn-outline-success","btn-sm","btn-closes",2,"float","right",3,"click"],["aria-hidden","true",1,"fa","fa-ok"],["aria-hidden","true",1,"fa","fa-check"],[1,"progressing"],["role","status",1,"spinner-grow","text-warning"],[1,"sr-only"],["role","status",1,"spinner-grow","text-secondary"],["role","status",1,"spinner-grow","text-success"],[1,"payment-waitin"],["type","button",1,"btn","btn-outline-warning","btn-sm","btn-open",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],[1,"footer-button"],["type","button",1,"btn","btn-outline-warning","btn-sm",3,"click"],["type","button","mat-dialog-close","",1,"btn","btn-outline-danger","btn-sm","btn-closes",2,"float","right"],["aria-hidden","true",1,"fa","fa-angle-double-left"]],template:function(n,a){n&1&&(e(0,"div",0)(1,"section",1)(2,"div",2)(3,"div",3),m(4,"div",4),e(5,"div",4)(6,"ol",5)(7,"li",6)(8,"a",7),t(9,"Home"),i()(),e(10,"li",8)(11,"a",7),t(12,"Payments"),i()()()()()()(),e(13,"section",9)(14,"div",2)(15,"div",10)(16,"div",11)(17,"div",12)(18,"div",13)(19,"h3",14),m(20,"i",15),t(21," Registration Fee Payment "),i()(),e(22,"div",16)(23,"table",17)(24,"tbody")(25,"tr")(26,"th",18),t(27,"Category Selected"),i(),e(28,"td"),t(29,":"),i(),e(30,"td"),t(31),i(),e(32,"td"),_(33,O,2,0,"button",19),i()(),e(34,"tr")(35,"th",18),t(36,"Registration Fees"),i(),e(37,"td"),t(38,":"),i(),e(39,"td")(40,"b")(41,"u"),t(42),S(43,"currency"),i()()(),e(44,"td"),t(45,"Paid: "),e(46,"b",20),t(47),i(),t(48," || Bal: "),e(49,"b",21)(50,"u"),t(51),S(52,"currency"),i()()()()()(),m(53,"hr"),_(54,Q,6,0,"div",22)(55,ee,48,7,"div",23),i()()()()()()()),n&2&&(s(31),h(a.categoryName),s(2),y("ngIf",a.categoryFees-a.applicantTotalPayment>0),s(9),h(x(43,7,a.categoryFees,"KES")),s(5),h(a.applicantTotalPayment),s(4),h(x(52,10,a.categoryFees-a.applicantTotalPayment,"KES")),s(3),y("ngIf",a.categoryFees-a.applicantTotalPayment<=0),s(),y("ngIf",a.categoryFees-a.applicantTotalPayment>0))},dependencies:[V,k,N,Y,L,B,W,D,U,j,R,K],encapsulation:2})};export{J as PaymentComponent};
