import{a as j,b as F,e as b}from"./chunk-VQ5F3ELZ.js";import{x as A}from"./chunk-ALENL7MX.js";import{a as U}from"./chunk-DSXUZT54.js";import{a as L}from"./chunk-RITIWUCH.js";import{a as $}from"./chunk-BQPUOODS.js";import"./chunk-2LP224VR.js";import{$ as S,$b as r,Bb as u,Ib as e,Jb as n,Kb as o,Pc as v,Qb as M,Rc as _,Sc as T,Vb as D,Wb as E,Xb as w,Zc as f,_c as k,ab as l,bc as d,ea as C,gb as h,gc as R,mc as I,nb as x,nc as O,qb as P}from"./chunk-EYQN4OQ3.js";j.register(...F);var y=class p{transform(a,t="KES",i=2){let s=typeof a=="string"?parseFloat(a):a;if(isNaN(s))return"";let c=s.toFixed(i).split(".");return c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),`${t}${c.join(".")}`}static \u0275fac=function(t){return new(t||p)};static \u0275pipe=P({name:"currencyFormat",type:p,pure:!0})};var g=class p{constructor(a){this.http=a}apiUrl=L.apiUrl+"/payments";getPayements(a,t,i){let s=new f().set("search",a).set("page",t.toString()).set("pageSize",i.toString());return this.http.get(this.apiUrl,{params:s})}getPremiumPayements(a,t,i,s){let m=new f().set("search",a).set("page",t.toString()).set("pageSize",i.toString());return this.http.get(this.apiUrl+"/byPackage?package="+s,{params:m})}getCustomerPayments(a){return this.http.get(this.apiUrl+"/byAccount?account_number="+a)}getPaymentsBetweenDates(a,t){return this.http.get(`${this.apiUrl}/dateRage?startDate=${a}&endDate=${t}`)}static \u0275fac=function(t){return new(t||p)(C(k))};static \u0275prov=S({token:p,factory:p.\u0275fac,providedIn:"root"})};var B=class p{constructor(a,t,i,s){this.paymentService=a;this.datePipe=t;this.mileageService=i;this.userService=s;let m=new Date;this.selectedMonth=this.datePipe.transform(m,"MM")||"",this.selectedYear=this.datePipe.transform(m,"yyyy")||"",this.monthStatics=m.toLocaleString("en-US",{month:"long",year:"numeric"}),this.loadPayments(),this.loadCustomers()}monthStatics;chart;payments=[];monthReports;monthTotalAmount=0;annualTotalAmount=0;selectedMonth;selectedYear="0";monthlyTotals;error="";availableYears=["2023","2024","2025"];totalCustomers;totalReports;date1;date2;monthDailySales=[];currencyPipe=new y;barChartOptions={responsive:!0,scales:{x:{title:{display:!0,text:"Days of Month"}},y:{min:0,title:{display:!0,text:"Sales Amount (KES)"}}},plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:""}}};barChartData={labels:[],datasets:[]};pieChartData={labels:["BYD","Legends","Masters","Ladies"],datasets:[{data:[300,500,200,250],backgroundColor:["rgb(255, 99, 132)","rgb(255, 206, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)"],hoverOffset:4}]};pieChartOptions={responsive:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"Categories Registrations"}}};ngOnInit(){}loadCustomers(){this.userService.getUsers("",1,0).subscribe(a=>{this.totalCustomers=a.total_count})}loadPayments(){let a=`${this.selectedMonth}/01/${this.selectedYear}`,t=`${this.selectedMonth}/31/${this.selectedYear}`;this.paymentService.getPaymentsBetweenDates(a,t).subscribe(i=>{this.payments=i.payments,this.monthTotalAmount=i.totalAmount,console.log(this.payments),this.monthDailySales=this.transformPaymentsToMonthDailySales(this.payments),console.log(this.monthDailySales),this.updateChartData()})}transformPaymentsToMonthDailySales(a){let t={};return a.forEach(i=>{let m=new Date(i.date_paid).toLocaleString("default",{month:"long",year:"numeric"}),c=i.date_paid.split(" ")[0];t[m]||(t[m]={}),t[m][c]||(t[m][c]=0),t[m][c]+=i.amount_paid}),Object.keys(t).map(i=>({month:i,sales:Object.keys(t[i]).map(s=>({date:s,amount:t[i][s]}))}))}onMonthChange(a){let t=a.target.value,[i,s]=t.split("-");this.selectedMonth=s,this.selectedYear=i,this.loadPayments()}updateChartData(){let a=this.monthDailySales[0]?.sales.map(i=>i.date)||[],t=this.monthDailySales.map(i=>({data:i.sales.map(s=>s.amount),label:"Total "+this.formatPrice(this.annualTotalAmount),backgroundColor:this.getRandomColor(.2),borderColor:this.getRandomColor(1),borderWidth:1}));this.barChartData={labels:a,datasets:t},this.chart&&this.chart.update()}getRandomColor(a){let t=Math.floor(Math.random()*255),i=Math.floor(Math.random()*255),s=Math.floor(Math.random()*255);return`rgba(${t}, ${i}, ${s}, ${a})`}formatPrice(a){return this.currencyPipe.transform(a)}static \u0275fac=function(t){return new(t||p)(h(g),h(v),h(U),h($))};static \u0275cmp=x({type:p,selectors:[["app-home"]],viewQuery:function(t,i){if(t&1&&D(b,5),t&2){let s;E(s=w())&&(i.chart=s.first)}},features:[R([v])],decls:132,vars:17,consts:[[1,"content-wrapper"],[1,"content-header"],[1,"container-fluid"],[1,"row"],[1,"col-lg-2","col-6"],[1,"small-box","bg-success"],[1,"inner"],[1,"amountSnip"],[1,"stat_description"],[1,"icon"],["aria-hidden","true",1,"fa","fa-credit-card"],[1,"small-box-footer"],[1,"fas","fa-arrow-circle-right"],[1,"small-box","bg-secondary"],["aria-hidden","true",1,"fa","fa-question-circle"],[1,"fa","fa-users"],[1,"small-box","bg-warning"],["aria-hidden","true",1,"fa","fa-thumbs-up"],[1,"small-box","bg-danger"],[1,"small-box","bg-primary"],[1,"col-lg-7","connectedSortable"],[1,"card"],[1,"card-header"],[1,"card-title"],[1,"fas","fa-chart-pie","mr-1"],[1,"card-tools"],[1,"nav","nav-pills","ml-auto"],["type","month","id","month",3,"change","value"],[1,"card-body"],[1,"tab-content","p-0"],["id","revenue-chart",1,"chart","tab-pane","active",2,"position","relative","min-height","300px"],["baseChart","",3,"type","data","options"],["id","sales-chart",1,"chart","tab-pane",2,"position","relative","height","300px"],["id","sales-chart-canvas","height","300",2,"height","300px"],[1,"col-lg-5","connectedSortable"],[1,"fas","fa-chart-bar","mr-1"],[1,"chart","tab-pane","active",2,"position","relative","min-height","300px"],[1,"chart-container-pie-chart"],["baseChart","",3,"data","options","type"],[1,"card-footer","bg-transparent"],[1,"col-4","text-center"],["id","sparkline-1"],[1,"text-white"],["id","sparkline-2"],["id","sparkline-3"]],template:function(t,i){t&1&&(e(0,"div",0)(1,"section",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"h4",7),r(8),I(9,"currency"),e(10,"span",8),r(11,"Fee"),n()(),e(12,"p"),r(13,"Total Payments"),n()(),e(14,"div",9),o(15,"i",10),n(),e(16,"a",11),r(17,"More info "),o(18,"i",12),n()()(),e(19,"div",4)(20,"div",13)(21,"div",6)(22,"h4",7),r(23),e(24,"span",8),r(25,"Applicants"),n()(),e(26,"p"),r(27,"Registrations"),n()(),e(28,"div",9),o(29,"i",14),n(),e(30,"a",11),r(31,"More info "),o(32,"i",12),n()()(),e(33,"div",4)(34,"div",5)(35,"div",6)(36,"h4",7),r(37),e(38,"span",8),r(39,"Submitted"),n()(),e(40,"p"),r(41,"Assessments"),n()(),e(42,"div",9),o(43,"i",15),n(),e(44,"a",11),r(45,"More info "),o(46,"i",12),n()()(),e(47,"div",4)(48,"div",16)(49,"div",6)(50,"h4",7),r(51),e(52,"span",8),r(53,"Unsubmitted"),n()(),e(54,"p"),r(55,"Assessments"),n()(),e(56,"div",9),o(57,"i",17),n(),e(58,"a",11),r(59,"More info "),o(60,"i",12),n()()(),e(61,"div",4)(62,"div",18)(63,"div",6)(64,"h4",7),r(65),e(66,"span",8),r(67,"Registrations"),n()(),e(68,"p"),r(69,"Unpaid"),n()(),e(70,"div",9),o(71,"i",17),n(),e(72,"a",11),r(73,"More info "),o(74,"i",12),n()()(),e(75,"div",4)(76,"div",19)(77,"div",6)(78,"h4",7),r(79),e(80,"span",8),r(81,"Registered"),n()(),e(82,"p"),r(83,"Regions"),n()(),e(84,"div",9),o(85,"i",17),n(),e(86,"a",11),r(87,"More info "),o(88,"i",12),n()()()(),e(89,"div",3)(90,"section",20)(91,"div",21)(92,"div",22)(93,"h3",23),o(94,"i",24),r(95),n(),e(96,"div",25)(97,"ul",26),r(98," View:"),e(99,"input",27),M("change",function(m){return i.onMonthChange(m)}),n()()()(),e(100,"div",28)(101,"div",29)(102,"div",30),o(103,"canvas",31),n(),e(104,"div",32),r(105," Annual Analysis Coming Soon... "),o(106,"canvas",33),n()()()()(),e(107,"section",34)(108,"div",21)(109,"div",22)(110,"h3",23),o(111,"i",35),r(112," Registration Trends "),n(),o(113,"div",25),n(),e(114,"div",28)(115,"div",36)(116,"div",37),o(117,"canvas",38),n()()(),e(118,"div",39)(119,"div",3)(120,"div",40),o(121,"div",41),e(122,"div",42),r(123,"Visitors"),n()(),e(124,"div",40),o(125,"div",43),e(126,"div",42),r(127,"Online"),n()(),e(128,"div",40),o(129,"div",44),e(130,"div",42),r(131,"Sales"),n()()()()()()()()()()),t&2&&(l(8),d("",O(9,14,0,"KES")," "),l(15),d("",0," "),l(14),d("",0," "),l(14),d("",0," "),l(14),d("",0," "),l(14),d("",0," "),l(16),d(" Daily Sales for ",i.monthStatics," "),l(4),u("value",i.selectedMonth),l(4),u("type","bar")("data",i.barChartData)("options",i.barChartOptions),l(14),u("data",i.pieChartData)("options",i.pieChartOptions)("type","pie"))},dependencies:[T,_,b,A],styles:[".stat_description[_ngcontent-%COMP%]{font-size:.3em}.chart-container[_ngcontent-%COMP%]{display:block;width:100%;max-width:350px;margin:0 auto}.amountSnip[_ngcontent-%COMP%]{font-size:1.8em}.chart-container-pie-chart[_ngcontent-%COMP%]{width:400px;height:400px;margin:auto}"]})};export{B as HomeComponent};
